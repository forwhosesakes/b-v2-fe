import{a as K,b as T,c as G,i as A,h as N,t as q,k as W,l as P,m as U,s as H,o as V,n as S,S as z,R as g,u as J,q as X,j as o,r as Y}from"./index-CWMO65Fh.js";import{b as Z}from"./index-DpjcARr_.js";import{s as ee,h as te,C as L}from"./circular-progress-DRkqyHXc.js";import re from"./fail-BVB1I5Pe.js";import se from"./success-Bs5rEX9N.js";import ie from"./in-progress-DYEm2nsd.js";import M from"./left-arrow-sDJAfT4n.js";import ne from"./right-arrow-Ctd6Bm4c.js";var ae=function(i){K(u,i);function u(n,t){var e;return e=i.call(this)||this,e.client=n,e.options=t,e.trackedProps=[],e.selectError=null,e.bindMethods(),e.setOptions(t),e}var s=u.prototype;return s.bindMethods=function(){this.remove=this.remove.bind(this),this.refetch=this.refetch.bind(this)},s.onSubscribe=function(){this.listeners.length===1&&(this.currentQuery.addObserver(this),B(this.currentQuery,this.options)&&this.executeFetch(),this.updateTimers())},s.onUnsubscribe=function(){this.listeners.length||this.destroy()},s.shouldFetchOnReconnect=function(){return O(this.currentQuery,this.options,this.options.refetchOnReconnect)},s.shouldFetchOnWindowFocus=function(){return O(this.currentQuery,this.options,this.options.refetchOnWindowFocus)},s.destroy=function(){this.listeners=[],this.clearTimers(),this.currentQuery.removeObserver(this)},s.setOptions=function(t,e){var a=this.options,r=this.currentQuery;if(this.options=this.client.defaultQueryObserverOptions(t),typeof this.options.enabled<"u"&&typeof this.options.enabled!="boolean")throw new Error("Expected enabled to be a boolean");this.options.queryKey||(this.options.queryKey=a.queryKey),this.updateQuery();var c=this.hasListeners();c&&_(this.currentQuery,r,this.options,a)&&this.executeFetch(),this.updateResult(e),c&&(this.currentQuery!==r||this.options.enabled!==a.enabled||this.options.staleTime!==a.staleTime)&&this.updateStaleTimeout();var l=this.computeRefetchInterval();c&&(this.currentQuery!==r||this.options.enabled!==a.enabled||l!==this.currentRefetchInterval)&&this.updateRefetchInterval(l)},s.getOptimisticResult=function(t){var e=this.client.defaultQueryObserverOptions(t),a=this.client.getQueryCache().build(this.client,e);return this.createResult(a,e)},s.getCurrentResult=function(){return this.currentResult},s.trackResult=function(t,e){var a=this,r={},c=function(d){a.trackedProps.includes(d)||a.trackedProps.push(d)};return Object.keys(t).forEach(function(l){Object.defineProperty(r,l,{configurable:!1,enumerable:!0,get:function(){return c(l),t[l]}})}),(e.useErrorBoundary||e.suspense)&&c("error"),r},s.getNextResult=function(t){var e=this;return new Promise(function(a,r){var c=e.subscribe(function(l){l.isFetching||(c(),l.isError&&(t!=null&&t.throwOnError)?r(l.error):a(l))})})},s.getCurrentQuery=function(){return this.currentQuery},s.remove=function(){this.client.getQueryCache().remove(this.currentQuery)},s.refetch=function(t){return this.fetch(T({},t,{meta:{refetchPage:t==null?void 0:t.refetchPage}}))},s.fetchOptimistic=function(t){var e=this,a=this.client.defaultQueryObserverOptions(t),r=this.client.getQueryCache().build(this.client,a);return r.fetch().then(function(){return e.createResult(r,a)})},s.fetch=function(t){var e=this;return this.executeFetch(t).then(function(){return e.updateResult(),e.currentResult})},s.executeFetch=function(t){this.updateQuery();var e=this.currentQuery.fetch(this.options,t);return t!=null&&t.throwOnError||(e=e.catch(G)),e},s.updateStaleTimeout=function(){var t=this;if(this.clearStaleTimeout(),!(A||this.currentResult.isStale||!N(this.options.staleTime))){var e=q(this.currentResult.dataUpdatedAt,this.options.staleTime),a=e+1;this.staleTimeoutId=setTimeout(function(){t.currentResult.isStale||t.updateResult()},a)}},s.computeRefetchInterval=function(){var t;return typeof this.options.refetchInterval=="function"?this.options.refetchInterval(this.currentResult.data,this.currentQuery):(t=this.options.refetchInterval)!=null?t:!1},s.updateRefetchInterval=function(t){var e=this;this.clearRefetchInterval(),this.currentRefetchInterval=t,!(A||this.options.enabled===!1||!N(this.currentRefetchInterval)||this.currentRefetchInterval===0)&&(this.refetchIntervalId=setInterval(function(){(e.options.refetchIntervalInBackground||W.isFocused())&&e.executeFetch()},this.currentRefetchInterval))},s.updateTimers=function(){this.updateStaleTimeout(),this.updateRefetchInterval(this.computeRefetchInterval())},s.clearTimers=function(){this.clearStaleTimeout(),this.clearRefetchInterval()},s.clearStaleTimeout=function(){this.staleTimeoutId&&(clearTimeout(this.staleTimeoutId),this.staleTimeoutId=void 0)},s.clearRefetchInterval=function(){this.refetchIntervalId&&(clearInterval(this.refetchIntervalId),this.refetchIntervalId=void 0)},s.createResult=function(t,e){var a=this.currentQuery,r=this.options,c=this.currentResult,l=this.currentResultState,d=this.currentResultOptions,p=t!==a,b=p?t.state:this.currentQueryInitialState,y=p?this.currentResult:this.previousQueryResult,h=t.state,R=h.dataUpdatedAt,I=h.error,j=h.errorUpdatedAt,E=h.isFetching,f=h.status,C=!1,w=!1,v;if(e.optimisticResults){var F=this.hasListeners(),k=!F&&B(t,e),D=F&&_(t,a,e,r);(k||D)&&(E=!0,R||(f="loading"))}if(e.keepPreviousData&&!h.dataUpdateCount&&(y!=null&&y.isSuccess)&&f!=="error")v=y.data,R=y.dataUpdatedAt,f=y.status,C=!0;else if(e.select&&typeof h.data<"u")if(c&&h.data===(l==null?void 0:l.data)&&e.select===this.selectFn)v=this.selectResult;else try{this.selectFn=e.select,v=e.select(h.data),e.structuralSharing!==!1&&(v=P(c==null?void 0:c.data,v)),this.selectResult=v,this.selectError=null}catch(x){U().error(x),this.selectError=x}else v=h.data;if(typeof e.placeholderData<"u"&&typeof v>"u"&&(f==="loading"||f==="idle")){var m;if(c!=null&&c.isPlaceholderData&&e.placeholderData===(d==null?void 0:d.placeholderData))m=c.data;else if(m=typeof e.placeholderData=="function"?e.placeholderData():e.placeholderData,e.select&&typeof m<"u")try{m=e.select(m),e.structuralSharing!==!1&&(m=P(c==null?void 0:c.data,m)),this.selectError=null}catch(x){U().error(x),this.selectError=x}typeof m<"u"&&(f="success",v=m,w=!0)}this.selectError&&(I=this.selectError,v=this.selectResult,j=Date.now(),f="error");var $={status:f,isLoading:f==="loading",isSuccess:f==="success",isError:f==="error",isIdle:f==="idle",data:v,dataUpdatedAt:R,error:I,errorUpdatedAt:j,failureCount:h.fetchFailureCount,errorUpdateCount:h.errorUpdateCount,isFetched:h.dataUpdateCount>0||h.errorUpdateCount>0,isFetchedAfterMount:h.dataUpdateCount>b.dataUpdateCount||h.errorUpdateCount>b.errorUpdateCount,isFetching:E,isRefetching:E&&f!=="loading",isLoadingError:f==="error"&&h.dataUpdatedAt===0,isPlaceholderData:w,isPreviousData:C,isRefetchError:f==="error"&&h.dataUpdatedAt!==0,isStale:Q(t,e),refetch:this.refetch,remove:this.remove};return $},s.shouldNotifyListeners=function(t,e){if(!e)return!0;var a=this.options,r=a.notifyOnChangeProps,c=a.notifyOnChangePropsExclusions;if(!r&&!c||r==="tracked"&&!this.trackedProps.length)return!0;var l=r==="tracked"?this.trackedProps:r;return Object.keys(t).some(function(d){var p=d,b=t[p]!==e[p],y=l==null?void 0:l.some(function(R){return R===d}),h=c==null?void 0:c.some(function(R){return R===d});return b&&!h&&(!l||y)})},s.updateResult=function(t){var e=this.currentResult;if(this.currentResult=this.createResult(this.currentQuery,this.options),this.currentResultState=this.currentQuery.state,this.currentResultOptions=this.options,!H(this.currentResult,e)){var a={cache:!0};(t==null?void 0:t.listeners)!==!1&&this.shouldNotifyListeners(this.currentResult,e)&&(a.listeners=!0),this.notify(T({},a,t))}},s.updateQuery=function(){var t=this.client.getQueryCache().build(this.client,this.options);if(t!==this.currentQuery){var e=this.currentQuery;this.currentQuery=t,this.currentQueryInitialState=t.state,this.previousQueryResult=this.currentResult,this.hasListeners()&&(e==null||e.removeObserver(this),t.addObserver(this))}},s.onQueryUpdate=function(t){var e={};t.type==="success"?e.onSuccess=!0:t.type==="error"&&!V(t.error)&&(e.onError=!0),this.updateResult(e),this.hasListeners()&&this.updateTimers()},s.notify=function(t){var e=this;S.batch(function(){t.onSuccess?(e.options.onSuccess==null||e.options.onSuccess(e.currentResult.data),e.options.onSettled==null||e.options.onSettled(e.currentResult.data,null)):t.onError&&(e.options.onError==null||e.options.onError(e.currentResult.error),e.options.onSettled==null||e.options.onSettled(void 0,e.currentResult.error)),t.listeners&&e.listeners.forEach(function(a){a(e.currentResult)}),t.cache&&e.client.getQueryCache().notify({query:e.currentQuery,type:"observerResultsUpdated"})})},u}(z);function ue(i,u){return u.enabled!==!1&&!i.state.dataUpdatedAt&&!(i.state.status==="error"&&u.retryOnMount===!1)}function B(i,u){return ue(i,u)||i.state.dataUpdatedAt>0&&O(i,u,u.refetchOnMount)}function O(i,u,s){if(u.enabled!==!1){var n=typeof s=="function"?s(i):s;return n==="always"||n!==!1&&Q(i,u)}return!1}function _(i,u,s,n){return s.enabled!==!1&&(i!==u||n.enabled===!1)&&(!s.suspense||i.state.status!=="error")&&Q(i,s)}function Q(i,u){return i.isStaleByTime(u.staleTime)}function oe(){var i=!1;return{clearReset:function(){i=!1},reset:function(){i=!0},isReset:function(){return i}}}var le=g.createContext(oe()),ce=function(){return g.useContext(le)};function he(i,u){var s=g.useRef(!1),n=g.useState(0),t=n[1],e=J(),a=ce(),r=e.defaultQueryObserverOptions(i);r.optimisticResults=!0,r.onError&&(r.onError=S.batchCalls(r.onError)),r.onSuccess&&(r.onSuccess=S.batchCalls(r.onSuccess)),r.onSettled&&(r.onSettled=S.batchCalls(r.onSettled)),r.suspense&&(typeof r.staleTime!="number"&&(r.staleTime=1e3),r.cacheTime===0&&(r.cacheTime=1)),(r.suspense||r.useErrorBoundary)&&(a.isReset()||(r.retryOnMount=!1));var c=g.useState(function(){return new u(e,r)}),l=c[0],d=l.getOptimisticResult(r);if(g.useEffect(function(){s.current=!0,a.clearReset();var p=l.subscribe(S.batchCalls(function(){s.current&&t(function(b){return b+1})}));return l.updateResult(),function(){s.current=!1,p()}},[a,l]),g.useEffect(function(){l.setOptions(r,{listeners:!1})},[r,l]),r.suspense&&d.isLoading)throw l.fetchOptimistic(r).then(function(p){var b=p.data;r.onSuccess==null||r.onSuccess(b),r.onSettled==null||r.onSettled(b,null)}).catch(function(p){a.clearReset(),r.onError==null||r.onError(p),r.onSettled==null||r.onSettled(void 0,p)});if(d.isError&&!a.isReset()&&!d.isFetching&&ee(r.suspense,r.useErrorBoundary,[d.error,l.getCurrentQuery()]))throw d.error;return r.notifyOnChangeProps==="tracked"&&(d=l.trackResult(d,r)),d}function de(i,u,s){var n=X(i,u,s);return he(n,ae)}const fe="/assets/reports-bg-Dea5E8LS.png",pe=i=>i.isHeatMap?o.jsx("div",{className:"heatmap"}):o.jsx("div",{className:"flex-1 normalMap p-0 m-0  h-[80vh] w-full",children:o.jsx(Z.LazyLoadImage,{className:"object-fill h-full w-full",src:fe})}),ve=async(i,u=1,s=10)=>await te({method:"get",url:`/report?search=${i}&limit=${s}&page=${u}`}),be=(i,u=1,s=10)=>de({queryKey:["reports",i,u,s],queryFn:()=>ve(i,u,s)}),me=new Map([["GARBAGE",{label:"نفايات",color:"text-[#8B4513]",border:"border border-[#654321]"}],["BAD_BILLBOARD",{label:"لوحة إعلانية سيئة",color:"text-[#4682B4]",border:"border border-[#36648B]"}],["SAND_ON_ROAD",{label:"رمل على الطريق",color:"text-[#F4A460]",border:"border border-[#D2691E]"}],["POTHOLES",{label:"حفر في الطريق",color:"text-[#A9A9A9]",border:"border border-[#808080]"}],["CLUTTER_SIDEWALK",{label:"رصيف مزدحم",color:"text-[#9ACD32]",border:"border border-[#6B8E23]"}],["GRAFFITI",{label:"كتابة على الجدران",color:"text-[#FF69B4]",border:"border border-[#C71585]"}],["BROKEN_SIGNAGE",{label:"لافتة مكسورة",color:"text-[#FFD700]",border:"border border-[#DAA520]"}]]),ye=i=>{const u=me.get(i.category.name);return u&&o.jsx("div",{className:` ${u.border} rounded-full px-2 py-1 min-w-24 ${u.color}  text-center`,children:o.jsxs("span",{className:"text-[10px]",children:[" ",u.label]})},i.category.id)},Re=i=>o.jsxs("div",{className:`flex w-full justify-between py-3 pl-2 pr-5 border-b border-b-white/30 transition-all hover:bg-white/5 ${i.selected&&"bg-white/5"}`,children:[o.jsx("p",{className:"w-64  ",children:i.report.title}),o.jsx("div",{className:"flex gap-x-5  w-64 ",children:i.report.categories.map(u=>o.jsx(ye,{category:u}))}),o.jsx("div",{className:"border-[rgba(255, 255, 255, 0.12)] bg-[rgba(255, 255, 255, 0.04)] h-4 w-4 rounded-full"}),o.jsxs("div",{className:"flex flex-row opacity-75",children:[i.report.id%3===0?o.jsx(re,{}):i.report.id%3===1?o.jsx(se,{}):o.jsx(ie,{}),o.jsx(M,{className:"mr-2",width:24,height:24})]})]}),ge=()=>{const[i,u]=Y.useState(3),{isLoading:s,isError:n,data:t,isFetching:e}=be("",i,10);return o.jsx("div",{className:"flex-1 p-3",children:o.jsxs("div",{children:[s?o.jsx("div",{children:o.jsx(L,{})}):n?o.jsx("div",{children:"Error: "}):o.jsx("div",{children:t.data.reports.map(a=>o.jsx(Re,{report:a,selected:!1},a.id))}),o.jsxs("div",{className:"pagination-actions flex flex-row justify-between m-3",children:[o.jsxs("p",{children:[" ",o.jsxs("span",{children:["Current Page: ",i+1]})]}),o.jsxs("div",{className:"flex gap-x-3",children:[o.jsx("button",{className:" button hover:opacity-60 hover:bg-white/5 transition-all ",onClick:()=>{u(a=>a+1)},children:o.jsx(ne,{width:24,height:24})}),o.jsx("button",{className:"button hover:opacity-60  hover:bg-white/5 transition-all ",onClick:()=>u(a=>Math.max(a-1,0)),disabled:i===0,children:o.jsx(M,{width:24,height:24})})]})]}),e?o.jsxs("span",{children:[" ",o.jsx(L,{})]}):null," "]})})},we=()=>o.jsxs("section",{className:"p-0! mt-36 flex flex-col ",id:"reports",children:[o.jsx("div",{className:"",children:o.jsx("h2",{})}),o.jsxs("div",{className:"flex flex-row justify-between",children:[o.jsx(ge,{}),o.jsx(pe,{isHeatMap:!1})]})]});export{we as default};
